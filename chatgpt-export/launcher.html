<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChatGPT History Exporter</title>
<style>
  :root {
    --bg: #1e1e2e; --surface: #181825; --overlay: #313244;
    --text: #cdd6f4; --subtext: #a6adc8; --accent: #cba6f7;
    --green: #a6e3a1; --red: #f38ba8; --blue: #89b4fa;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg); color: var(--text); min-height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    display: flex; flex-direction: column; align-items: center; padding: 40px 20px;
  }
  h1 { font-size: 32px; color: var(--accent); margin-bottom: 8px; }
  .subtitle { color: var(--subtext); font-size: 16px; margin-bottom: 36px; text-align: center; max-width: 900px; }
  .card {
    background: var(--surface); border: 1px solid var(--overlay); border-radius: 16px;
    padding: 28px 32px; max-width: 860px; width: 100%; margin-bottom: 24px;
  }
  .card h2 { font-size: 18px; color: var(--accent); margin-bottom: 14px; }
  .steps { list-style: none; counter-reset: step; }
  .steps li {
    counter-increment: step; padding: 10px 0 10px 44px; position: relative;
    font-size: 15px; line-height: 1.6; border-left: 2px solid var(--overlay); margin-left: 14px;
  }
  .steps li:last-child { border-left-color: transparent; }
  .steps li::before {
    content: counter(step); position: absolute; left: -14px; top: 8px;
    width: 28px; height: 28px; background: var(--accent); color: var(--bg);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: 13px;
  }
  code {
    background: var(--overlay); padding: 2px 6px; border-radius: 4px;
    font-size: 13px; font-family: "SF Mono", "Fira Code", monospace;
  }
  kbd {
    background: var(--overlay); border: 1px solid #45475a; padding: 2px 7px;
    border-radius: 4px; font-size: 12px; font-family: inherit;
  }
  .btn-group { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 18px; }
  button {
    padding: 12px 24px; border: none; border-radius: 10px; cursor: pointer;
    font-size: 15px; font-weight: 600; transition: all 0.2s;
  }
  .btn-primary { background: var(--accent); color: var(--bg); }
  .btn-primary:hover { background: var(--blue); }
  .btn-secondary { background: var(--overlay); color: var(--text); }
  .btn-secondary:hover { background: #45475a; }
  .toast {
    position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
    background: var(--green); color: var(--bg); padding: 12px 28px;
    border-radius: 10px; font-weight: 600; font-size: 14px; opacity: 0;
    transition: opacity 0.3s; pointer-events: none;
  }
  .toast.show { opacity: 1; }
  .note {
    background: rgba(137,180,250,0.08); border-left: 3px solid var(--blue);
    padding: 12px 16px; border-radius: 0 8px 8px 0; margin-top: 14px;
    font-size: 13px; color: var(--subtext); line-height: 1.5;
  }
  .warn {
    background: rgba(243,139,168,0.08); border-left: 3px solid var(--red);
    padding: 12px 16px; border-radius: 0 8px 8px 0; margin-top: 14px;
    font-size: 13px; color: var(--subtext); line-height: 1.5;
  }
  .features { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
  .feature {
    display: flex; align-items: flex-start; gap: 8px; font-size: 14px; color: var(--subtext);
  }
  .feature .check { color: var(--green); font-weight: 700; flex-shrink: 0; }
  .script-url {
    margin-top: 10px; font-size: 12px; color: var(--subtext); word-break: break-all;
  }
  footer { margin-top: 40px; color: #585b70; font-size: 12px; text-align: center; max-width: 860px; }
</style>
</head>
<body>

<h1>ChatGPT History Exporter</h1>
<p class="subtitle">
  Export and continuously sync your ChatGPT history with resumable storage, progress coverage, and optional cloud uploads.
</p>

<div class="card">
  <h2>What this version does</h2>
  <div class="features">
    <div class="feature"><span class="check">&#10003;</span> Manual mode (user initiated) and Auto-sync mode</div>
    <div class="feature"><span class="check">&#10003;</span> Coverage metric: % synced + date covered back to</div>
    <div class="feature"><span class="check">&#10003;</span> Incremental sync while you keep using ChatGPT</div>
    <div class="feature"><span class="check">&#10003;</span> Resume-safe local IndexedDB storage checkpoints</div>
    <div class="feature"><span class="check">&#10003;</span> Duplicate protection (skips chats already up-to-date)</div>
    <div class="feature"><span class="check">&#10003;</span> Optional cloud endpoint uploads with retry queue</div>
    <div class="feature"><span class="check">&#10003;</span> Params: limit last N, backfill date boundary, multi-message filter</div>
    <div class="feature"><span class="check">&#10003;</span> Download snapshots as JSON/Markdown any time</div>
  </div>
</div>

<div class="card">
  <h2>How to use</h2>
  <ol class="steps">
    <li>Open <a href="https://chatgpt.com" target="_blank" style="color:var(--blue)">chatgpt.com</a> and log in.</li>
    <li>Open browser DevTools Console:
      <br><kbd>F12</kbd> or <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>J</kbd> (Windows/Linux)
      <br><kbd>Cmd</kbd>+<kbd>Option</kbd>+<kbd>J</kbd> (Mac)
    </li>
    <li>Click <strong>"Copy Full Export Script"</strong> below, paste into console, press <kbd>Enter</kbd>.</li>
    <li>In the panel, choose:
      <br>- <strong>User initiated mode</strong> for one-off sync/export
      <br>- <strong>Auto mode</strong> to keep syncing while the tab is open
    </li>
    <li>Set your preset params (limit/date/filter), storage target (local/cloud), and run.</li>
  </ol>

  <div class="btn-group">
    <button class="btn-primary" id="copyBtn">Copy Full Export Script</button>
    <button class="btn-secondary" id="copyLoaderBtn">Copy Short Loader (console)</button>
  </div>

  <div class="note">
    <strong>Short loader:</strong> this is useful when you want a compact snippet in your notes.
    Paste it in the console and it will fetch the full script from this page origin.
  </div>
  <div class="script-url">Script URL: <span id="scriptUrl"></span></div>
</div>

<div class="card">
  <h2>Bookmarklet / favorites link status</h2>
  <div class="warn">
    <strong>Known limitation:</strong> chatgpt.com is protected by Cloudflare and often blocks
    <code>javascript:</code> bookmarklets/favorites links. Use the Console method above.
  </div>
</div>

<div id="toast" class="toast">Copied to clipboard!</div>

<footer>
  By default, data is stored only in your local browser (IndexedDB). Data leaves your browser only if you explicitly configure a cloud endpoint in the exporter panel.
</footer>

<script>
(function() {
  let cachedScript = null;
  const scriptUrl = new URL("chatgpt-export.js", window.location.href).href;

  document.getElementById("scriptUrl").textContent = scriptUrl;

  async function loadScript() {
    if (cachedScript) return cachedScript;
    try {
      const res = await fetch(scriptUrl, { cache: "no-store" });
      if (!res.ok) throw new Error("HTTP " + res.status);
      cachedScript = await res.text();
    } catch {
      cachedScript = null;
    }
    return cachedScript;
  }

  function showToast(msg) {
    const t = document.getElementById("toast");
    t.textContent = msg || "Copied to clipboard!";
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 2200);
  }

  async function copyTextWithFallback(text, successMsg) {
    try {
      await navigator.clipboard.writeText(text);
      showToast(successMsg);
    } catch {
      const w = window.open("", "_blank");
      w.document.write("<pre>" + text.replace(/</g, "&lt;") + "</pre>");
      showToast("Clipboard blocked - opened in new tab");
    }
  }

  function buildShortLoader() {
    const urlLiteral = JSON.stringify(scriptUrl);
    return `(async()=>{const u=${urlLiteral}+"?t="+Date.now();const r=await fetch(u,{cache:"no-store"});if(!r.ok)throw new Error("Exporter load failed: HTTP "+r.status);(0,eval)(await r.text());})();`;
  }

  document.getElementById("copyBtn").addEventListener("click", async () => {
    const script = await loadScript();
    if (!script) {
      showToast("Could not load script - copy manually from chatgpt-export.js");
      return;
    }
    await copyTextWithFallback(script, "Full export script copied!");
  });

  document.getElementById("copyLoaderBtn").addEventListener("click", async () => {
    const loader = buildShortLoader();
    await copyTextWithFallback(loader, "Short loader copied!");
  });
})();
</script>
</body>
</html>
